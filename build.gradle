description = "Easy for Common: Build"

// Gradle files to be applied:
ext {
    gradles = [
            repositories  : "${rootProject.rootDir}/buildSrc/repositories.gradle",
            deployJar     : "${rootProject.rootDir}/buildSrc/deploy-jar.gradle",
            deployPlatform: "${rootProject.rootDir}/buildSrc/deploy-platform.gradle",
            compile       : "${rootProject.rootDir}/buildSrc/compile.gradle",
            auth          : "${rootProject.rootDir}/buildSrc/auth.gradle",
            config        : "${rootProject.rootDir}/buildSrc/config.gradle",
    ]
}

apply from: gradles.config

ext {
    isSnapshot = isTrue(config.snapshot)
}

config.version = (isSnapshot ? "${version}-SNAPSHOT" : version)
config.sampleVersion = (isSnapshot ? "${version}-SNAPSHOT" : version)
version = config.version

// Note in gradles.auth some personal setting should be implemented.
apply from: gradles.auth

allprojects { project ->
    processProjectInfo(project)
}

subprojects { project ->
}

tasks.withType(JavaCompile) {
    options.encoding = "UTF-8"
}

def processProjectInfo(Project project) {
    if (project == rootProject) {
        // NOP
    } else if (project.group.toString().startsWith("srclab-")) {
        project.group = config.starterGroup
        project.version = config.version
    } else if (project.group.toString().startsWith("srclab-samples")) {
        project.group = config.sampleGroup
        project.version = config.sampleVersion
    } else {
        project.group = config.group
        project.version = config.version
    }
    println("Configure ${project.group}:${project.name}:${project.version}")
}

static def isTrue(String string) {
    return string != null && (
            Boolean.parseBoolean(string)
                    || string.equalsIgnoreCase("yes")
                    || string.equalsIgnoreCase("1")
    )
}