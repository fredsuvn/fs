= image:../../logo.svg[Boat Id] `boat-id`: Boat Id -- link:../../README.md[Boat] ID生成库
:toc:
:toclevels: 3
:toc-title: 目录
:last-update-label!:
Sun Qian <fredsuvn@163.com>
:encoding: UTF-8
:emaill: fredsuvn@163.com

== 简介

Boat Id 是一个简单的 link:../../README.md[Boat] ID生成库.
它提供一套接口如 `IdGenerator` 和 `IdSpec` 来生成新id.

== Usage

=== IdSpec

要创建一套id生成规则, 我们可以使用 `IdSpec`:

.Java Examples
[source,java]
----
class Example{
    @Test
    public void test() {
        String spec = "seq-{Snowflake, 20, 41, 10, 12}-tail";
        IdSpec stringIdSpec = new IdSpec(spec);
        String id = stringIdSpec.newId();
    }
}
----

.Kotlin Examples
[source,kotlin]
----
class Example {
    @Test
    fun test() {
        val spec = "seq-{Snowflake, 20, 41, 10, 12}-tail"
        val stringIdSpec = IdSpec(spec)
        val id = stringIdSpec.newId()
    }
}
----

结果可能是: `seq-06803239610792857600-tail`

`IdSpec` 由字面量和 ``IdComponent``们组成,
``IdComponent``是被 `{` and `}` 包裹的申明, 格式是 `{type[: name][, arg]+}`
(一个逗号后面可以跟一个空格或者不跟, 因为空格都会被忽略).

NOTE: ``IdSpec`` 的语法规则来自 `boat-core` 的 `CharsTemplate`.

`IdSpec` 有1个内置 `IdComponent`:

* `Snowflake`

更多关于 `IdSpec` 的细节请参阅它的javadoc.

=== IdGenerator

`IdGenerator` 是 boat-id 的核心接口, `IdSpec` 是它的子类.
我们可以创建一个 `IdGenerator` 来定制生成规则.

.Java Examples
[source,java]
----
public class MyIdComponent implements IdComponent<String> {

    public static final String TYPE = "My";

    private String value;

    @NotNull
    @Override
    public String type() {
        return TYPE;
    }

    @Override
    public void init(@NotNull List<?> args) {
        this.value = String.valueOf(args.get(0));
    }

    @Override
    public String newValue(@NotNull IdContext context) {
        return value;
    }
}
----

.Kotlin Examples
[source,kotlin]
----
class MyIdComponent : IdComponent<String?> {

    private var value: String? = null
    override val type: String = TYPE

    override fun init(args: List<Any>) {
        value = args[0].toString()
    }

    override fun newValue(context: IdContext): String? {
        return value
    }

    companion object {
        const val TYPE = "My"
    }
}
----

然后, 加入 `MyIdComponent`:

.Java Examples
[source,java]
----
class Example{
    @Test
    public void test() {
        IdSpec stringIdSpec = new IdSpec(spec, type -> {
            if (type.equals(MyIdComponent.TYPE)) {
                return new MyIdComponent();
            }
            return IdSpec.DEFAULT_COMPONENT_SUPPLIER.get(type);
        });
    }
}
----

.Kotlin Examples
[source,kotlin]
----
class Example {
    @Test
    fun test() {
        val stringIdSpec = IdSpec(spec, object : ComponentSupplier {
            override fun get(type: String): IdComponent<*> {
                if (type == MyIdComponent.TYPE) {
                    return MyIdComponent()
                }
                return IdSpec.DEFAULT_COMPONENT_SUPPLIER.get(type)
            }
        })
    }
}
----

== Samples

.Java Examples
[source,java]
----
include::../../boat-sample/src/test/java/sample/java/xyz/srclab/id/IdSample.java[]
----

[source,java]
----
include::../../boat-sample/src/test/java/sample/java/xyz/srclab/id/MyIdComponent.java[]
----

.Kotlin Examples
[source,kotlin]
----
include::../../boat-sample/src/test/kotlin/sample/kotlin/xyz/srclab/id/IdSample.kt[]
----