plugins {
  id 'build.jar'
  id 'org.jetbrains.kotlin.plugin.lombok' version '1.7.0'
  id 'io.freefair.lombok' version '5.3.0'
}

description = "Core of mage."

java {
  registerFeature('optionalSupport') {
    usingSourceSet(sourceSets.main)
  }
}

dependencies {
  api platform(project(":boat-dependencies"))

  api project(":boat-annotations")

  compileOnly group: 'org.projectlombok', name: 'lombok', version: '1.18.26'
  annotationProcessor group: 'org.projectlombok', name: 'lombok', version: '1.18.26'

  compileOnly "org.springframework:spring-core"
  compileOnly "cglib:cglib"

  testImplementation project(":boat-test")
  testImplementation "commons-beanutils:commons-beanutils"
  testImplementation "org.springframework:spring-core"
  testImplementation "cglib:cglib"

  implementation project(":fs-processor")
  annotationProcessor project(":fs-processor")

  testAnnotationProcessor platform(project(":boat-dependencies"))
  testAnnotationProcessor "org.openjdk.jmh:jmh-generator-annprocess"

  testImplementation "org.apache.velocity:velocity"
  testImplementation "io.netty:netty-all"

  //testImplementation group: 'cn.hutool', name: 'hutool-all', version: '5.7.14'

  testImplementation 'org.apache.velocity:velocity-engine-core:2.3'
  // https://mvnrepository.com/artifact/com.github.javaparser/javaparser-core
  testImplementation group: 'com.github.javaparser', name: 'javaparser-core', version: '3.25.2'
  // https://mvnrepository.com/artifact/com.github.javaparser/javaparser-symbol-solver-core
  testImplementation group: 'com.github.javaparser', name: 'javaparser-symbol-solver-core', version: '3.25.2'

}

//utils.writeBuildInfos(project, "src/main/resources/META-INF/build.properties")

tasks.register('buildFs') {
  dependsOn 'compileJava'
  mustRunAfter 'clean'
}

task compileFs {
  dependsOn 'clean', 'compileJava'
}